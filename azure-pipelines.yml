trigger:
  branches:
    include:
    - main
    - feature/*  # Optional: Trigger for feature branches

pool:
  vmImage: 'windows-latest'

variables:
  VCPKG_ROOT: '$(Build.SourcesDirectory)/vcpkg'
  BUILD_DIR: '$(Build.BinariesDirectory)'

steps:
# Step 1: Checkout the repository
- checkout: self
  clean: true
  fetchDepth: 1
  displayName: 'Checkout Source Code'

# Step 2: Install vcpkg if not already available
- script: |
    git clone https://github.com/microsoft/vcpkg.git $(VCPKG_ROOT)
    .\vcpkg\bootstrap-vcpkg.bat || exit 1
  displayName: 'Install vcpkg'

# Step 3: Install Boost.JSON via vcpkg
- script: |
    .\vcpkg\vcpkg.exe install boost-json:x86-windows || exit 1
  displayName: 'Install Boost.JSON dependency'

# Step 4: Prepare project for building with MSBuild
- script: |
    mkdir $(BUILD_DIR)
    cd $(BUILD_DIR)
    # Assuming the main project file is 'SampleBoostApp.sln'
    echo 'Visual Studio solution preparation complete.'
  displayName: 'Prepare project with MSBuild'

# Step 5: Build the project with MSBuild
- script: |
    cd $(BUILD_DIR)
    .\$(VCPKG_ROOT)\x64\Release\MSBuild.exe SampleBoostApp.sln /p:Configuration=Release || exit 1
  displayName: 'Build the project with MSBuild'

# Step 6: Publish build artifacts
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(BUILD_DIR)'
    artifactName: 'build-output-$(Build.BuildId)'
    publishLocation: 'Container'
  displayName: 'Publish Build Artifacts'
